#!/bin/bash
try() {
  expected="$1"
  input="$2"

  ./9cc "$input" > tmp.s
  gcc -o tmp tmp.s helper.o
  ./tmp
  actual="$?"

  if [ "$actual" = "$expected" ]; then
    echo "$input => $actual"
  else
    echo "$input => $expected expected, but got $actual"
    exit 1
  fi
}

try 0 "0;"
try 101 "101;"
try 42 "42;"
try 0 "42+42-40-40-1-1-1-1;"
try 0 "42 +42 -40  -40-     1 -1-1-1;"
try 41 " 12 + 34 - 5 ;"
try 2 "1+1;"
try 47 "5+6*7;"
try 15 "5*(9-6);"
try 4 "(3+5)/2;"
try 13 "1   * ( 2* ( 2  +1+2*(6-1)       ))/(  6 /( 2 +1))  ;"
try 4 "-10+14;"
try 4 "+14-10;"
try 3  "-(-(-(-3)));"
try 1 "1==1;"
try 0 "2==12;"
try 1 "(1+1-2+1)==1;"
try 1 "1==((1==2)+(-1==-1))==1;"
try 1 "1!=100;"
try 0 "(1+2+3)!=(1*2*3);"
try 1 "(1+2+3+4)!=(1*2*3*4);"
try 1 "2<3;"
try 1 "3>1;"
try 1 "(3>1)==(1<3);"
try 1 "1+2>1*2;"
try 0 "1*2*3<1+2+3;"
try 1 "2<=3;"
try 1 "3>=1;"
try 1 "(3>=1)==(1<=3);"
try 1 "1+2>=1*2;"
try 1 "2*1*2*3/2<=1+2+3;"
try 1 "a=1;"
try 3 "a=1;b=2;a+b;"
try 4 "a=1;b=a;c=a*b+a;c+2;"
try 3 "a=1;b=2;c=2*(a==b)+3*(a!=b);c;"
try 3 "foo=1;bar=2;baz=2*(foo==bar)+3*(foo!=bar);baz;"
try 100 "OKTHISISAVERYLONGLONGLONGNAME_____10101010aaaaaaaa=100;"
try 0 "a=1;b=2;c=1+b+a/2;return 0;"
try 3 "a=1;b=2;c=1+b+a/2;return c;"
try 2 "return0= 1;return0=2;return return0;"
try 3 "if (2==1) return 2; return 3;"
try 2 "if (1==1) return 2; return 3;"
try 100 "a=10;if (a==10) a=a*10; return a;"
try 11 "a=11;if (a==10) a=a*10; return a;"
try 4 "a=1;if (a==1) a=a+1;if (a==2) a=a+1;if (a==3) a=a+1;if (a==3) a=a+1; return a;"
try 1 "if (1==1)a=1;else a=2; return a; "
try 3 "if (2==1)a=1;else if (1==2) a=2; else a=3; return a; "
try 3 "if (2==1)a=1;else if (1==2) a=2; else if (1==1) a=3;else a=4; return a; "
try 3 "9%6;"
try 1 "a=27;count=0;while(a!=1)if (a%2==0) a=a/2;else a=3*a+1;return a;"
try 55 "sum=0;for (a=1;a<=10;a=a+1)sum=sum+a;return sum;"
try 55 "sum=0;a=1;for (;a<=10;a=a+1)sum=sum+a;return sum;"
try 55 "sum=0;a=1;for (;;a=a+1)if (a==55) return a;return 0;"
try 55 "sum=0;a=1;for (;;)if (a==55) return a;else a=a+1;return 0;"
try 55 "sum=0;a=1;for (;a<55;)if (0==55) return a;else a=a+1;return a;"
try 0 "a=0;i=0;for (i=0;i<65536*16;i=i+1){a=0;}return 0; "
try 50 "a=0;i=0;for (i=0;i<10;i=i+1){a=a+1;a=a+1;a=a+1;a=a+1;a=a+1;}return a;"
try 0 "a=0;i=0;{{{{{{{{0;}}}}}}}}return 0;"
try 111 "a=27;count=0;while (a!=1){if (a%2==0){a=a/2;}else{a=3*a+1;}count=count+1;}return count;"
try 42 "if (ret_42()==42) a=ret_42(); while (ret_42()!=42){ a=1;}return a;"
echo OK